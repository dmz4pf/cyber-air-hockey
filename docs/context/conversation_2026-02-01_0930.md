# Context Snapshot - Air Hockey Linera Fix
**Date:** 2026-02-01 09:30

## Root Cause Found

**The backend REST API server (port 4000) is NOT running.**

The architecture requires TWO servers:
1. Frontend (Next.js) - port 3000 ✅ Running
2. Backend (Express + WebSocket) - port 4000 ❌ NOT Running

## Architecture

```
Frontend (3000) → REST API (4000) → Local Storage + Optional Blockchain
                         ↓
               WebSocket Game Server
```

The frontend's `lineraAPI.ts` connects to `localhost:4000/api/health` which fails with ERR_CONNECTION_REFUSED.

## Key Files
- `src/lib/api/linera-api.ts` - REST client expecting port 4000
- `src/hooks/useLineraGame.ts` - Uses lineraAPI, checks server health
- `server/src/index.ts` - Express server that should run on port 4000

## The FIX

Start the backend server:
```bash
cd /Users/MAC/Desktop/dev/linera/air-hockey/server && npm run dev
```

## Previous Session Fixes (Applied)
1. Puck interpolation jump detection - Clear buffer on >100px jumps
2. ESC button repositioned to top right
3. Server physics: Don't apply minSpeed during goal pause or 1s after reset
4. Changed USE_MOCK_CLIENT to only be true when explicitly set

## Env Config
- `NEXT_PUBLIC_API_URL=http://localhost:4000`
- `NEXT_PUBLIC_WS_URL=ws://localhost:4000/ws`
- `NEXT_PUBLIC_USE_MOCK_LINERA=false`
