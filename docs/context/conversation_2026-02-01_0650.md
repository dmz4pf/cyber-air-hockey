# Context Snapshot - Air Hockey Multiple Bugs
**Date:** 2026-02-01 06:50
**Context Usage:** 397%

## Current Issues
1. **Puck reverts to center** - After bouncing off walls, puck jumps back to center
2. **ESC to pause position** - Should be top right, not current position
3. **Game disconnected** - Need to check reconnection logic

## Fixes Applied This Session
1. Winner display bug - Changed modals to use `multiplayerEngine.playerNumber` instead of game store's
2. Puck interpolation - Added `useInterpolation` for smoother puck movement
3. Multiplayer detection - Using `gameModeType` for reliable detection
4. AI physics disabled in multiplayer - Server is authoritative

## Puck Revert Issue - Hypothesis
The server physics engine has a `validateAndRecoverPuckState()` function that resets puck to center when it detects "out of bounds". This may be triggering incorrectly after wall bounces.

Location: `server/src/physics/engine.ts` - `validateAndRecoverPuckState()` method

## Reconnection Logic - Files to Check
- `src/contexts/MultiplayerContext.tsx` - WebSocket connection handling
- `server/src/services/game-server.ts` - Server-side connection management

## Files Modified This Session
- `src/hooks/useMultiplayerGameEngine.ts` - Puck interpolation, playerNumber null check
- `src/hooks/useGameEngine.ts` - Disabled physics in multiplayer
- `src/app/(cyber)/game/page.tsx` - Fixed playerNumber for all modals

## Next Steps
1. Fix puck revert issue in server physics
2. Move ESC button to top right
3. Investigate disconnection and reconnection logic
