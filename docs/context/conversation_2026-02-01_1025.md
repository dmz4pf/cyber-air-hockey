# Context Snapshot - Air Hockey Puck Physics Fix
**Date:** 2026-02-01 10:25

## Current Task
Fixing multiplayer puck physics - puck returns to center unexpectedly during gameplay.

## Key Decisions Made
1. Removed `maintainMinimumSpeed()` - puck should stay still until hit (like real air hockey)
2. Changed `validateAndRecoverPuckState()` to CLAMP instead of RESET for boundary escapes
3. Only reset to center for NaN/Infinity values (truly invalid state)
4. Added initial random velocity when game starts (matches AI mode)
5. After goal, puck now serves to loser's end instead of center

## Implementation State
- [x] Added detailed logging to `resetPuck()` with call stack
- [x] Added logging for goal scoring
- [x] Added logging for boundary clamping
- [x] Added initial puck velocity on game start
- [x] Fixed post-goal puck position (serves to loser's end)
- [ ] Root cause of puck returning to center still unknown

## Files Modified This Session
- `server/src/physics/engine.ts`:
  - Added `serveToward` parameter to `resetPuck()`
  - Added detailed logging throughout
  - Added initial velocity in `start()`
  - Removed `maintainMinimumSpeed()` call
  - Changed boundary escape from reset to clamp

## Active Servers
- Frontend: http://localhost:3000 (running)
- Backend: http://localhost:4000 (running)

## Next Steps
1. User is testing the game with new logging
2. Need to see server logs when puck returns to center
3. Logs will show if it's: goal detection, NaN/Infinity, or something else

## Debug Approach
Server logs will show:
- `[Physics] resetPuck() called!` with call stack
- `[Physics] GOAL SCORED by player X`
- `[Physics] Puck boundary clamp`
- `[Physics] CRITICAL: Puck state invalid (NaN/Infinity)`
