# Context Snapshot - Air Hockey Multiplayer Smoothness
**Date:** 2026-02-01 05:45
**Context Usage:** 290%

## Current Task
User reports multiplayer game mechanics are "messed up" - movement of puck, paddle not as smooth as AI mode.

## Previous Session Fixes (Completed)
1. **`src/app/(cyber)/game/page.tsx`** - Added `gameModeType` selector for reliable multiplayer detection
2. **`src/hooks/useMultiplayerGameEngine.ts`** - Added null check for `playerNumber` before sending paddle moves
3. **`src/hooks/useGameEngine.ts`** - Disabled AI physics loop in multiplayer mode (server-authoritative)

## Key Architecture
- **AI Mode**: Local physics engine runs at 60fps, smooth client-side simulation
- **Multiplayer Mode**: Server-authoritative at 30Hz, client renders server state directly
- **Problem**: Server tick rate (30Hz) vs client frame rate (60fps) causes jerky movement

## Root Cause Hypothesis
The multiplayer engine directly applies server state without interpolation:
- Server sends state at 30Hz (every ~33ms)
- Client renders at 60fps (every ~16ms)
- Without interpolation, positions "jump" between server updates

## Files to Investigate
- `src/hooks/useMultiplayerGameEngine.ts` - How server state is applied to rendering
- `server/src/game/GameRoom.ts` - Server tick rate and state broadcasting
- Compare with `src/hooks/useGameEngine.ts` - How AI mode achieves smooth movement

## Implementation Options
1. **Client-side interpolation**: Smoothly interpolate between server state updates
2. **Increase server tick rate**: 60Hz instead of 30Hz (more bandwidth)
3. **Client-side prediction**: Predict movement locally, reconcile with server

## Next Steps
1. Read `useMultiplayerGameEngine.ts` to understand current state application
2. Implement interpolation for smooth rendering between server ticks
3. Test multiplayer smoothness matches AI mode

## Blockers
None - dev server and backend are running

## Files Modified This Session
- `src/app/(cyber)/game/page.tsx` - Multiplayer detection fix
- `src/hooks/useMultiplayerGameEngine.ts` - playerNumber null check
- `src/hooks/useGameEngine.ts` - Disabled physics in multiplayer
